import { useEffect, useState } from "react";
import { getTopHeadlines } from "./api/newsApi";
import { useDebounce } from "./hooks/useDebounce";
import SkeletonCard from "./components/SkeletonCard";

// –¢–∏–ø —Å—Ç–∞—Ç—å–∏ ‚Äî —á—Ç–æ–±—ã —É–¥–æ–±–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –Ω–æ–≤–æ—Å—Ç–µ–π
type Article = {
  title: string;
  description: string;
  url: string;
  urlToImage: string;
};

function App() {
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–ø–∏—Å–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π
  const [articles, setArticles] = useState<Article[]>([]);
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è "–ó–∞–≥—Ä—É–∑–∫–∞..."
  const [isLoading, setIsLoading] = useState<boolean>(true);
  const [country, setCountry] = useState("us");
  const [searchQuery, setSearchQuery] = useState("");
  const debouncedSearchQuery = useDebounce(searchQuery, 500);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchNews = async () => {
      try {
        setIsLoading(true);
        const data = await getTopHeadlines(country);
        setArticles(data);
        setError(null); // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –≤—Å—ë –æ–∫
      } catch (err) {
        setError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ—Å—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
        setArticles([]);
      } finally {
        setIsLoading(false);
      }
    };

    fetchNews();
  }, [country]);
  // useEffect —Å –ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π [] ‚Äî –≤—ã–∑–æ–≤–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

  const filteredArticles = articles.filter((article) =>
    article.title.toLowerCase().includes(debouncedSearchQuery.toLowerCase())
  );

  return (
    <div style={{ padding: "2rem", fontFamily: "sans-serif" }}>
      <select value={country} onChange={(e) => setCountry(e.target.value)}>
        <option value="us">üá∫üá∏ –°–®–ê</option>
        <option value="ru">üá∑üá∫ –†–æ—Å—Å–∏—è</option>
        <option value="de">üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è</option>
        <option value="fr">üá´üá∑ –§—Ä–∞–Ω—Ü–∏—è</option>
      </select>

      <input
        type="text"
        placeholder="–ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π..."
        value={searchQuery}
        onChange={(e) => setSearchQuery(e.target.value)}
        style={{
          padding: "0.5rem 1rem",
          borderRadius: "5px",
          border: "1px solid #ccc",
          marginBottom: "1rem",
          width: "100%",
          maxWidth: "400px",
        }}
      />

      <button
        onClick={() => setSearchQuery("")}
        style={{
          marginLeft: "1rem",
          padding: "0.5rem 1rem",
          borderRadius: "5px",
          border: "1px solid #ccc",
          backgroundColor: "#444",
          color: "#fff",
          cursor: "pointer",
        }}
      >
        –°–±—Ä–æ—Å–∏—Ç—å
      </button>

      <h1>–ù–æ–≤–æ—Å—Ç–∏</h1>

      {error && <p style={{ color: "red", marginTop: "1rem" }}>{error}</p>}

      {isLoading ? (
        <div
          style={{
            display: "grid",
            gap: "1.5rem",
            gridTemplateColumns: "repeat(auto-fit, minmax(300px, 1fr))",
          }}
        >
          {Array.from({ length: 6 }).map((_, index) => (
            <SkeletonCard key={index} />
          ))}
        </div>
      ) : (
        <div
          style={{
            display: "grid",
            gap: "1.5rem",
            gridTemplateColumns: "repeat(auto-fit, minmax(300px, 1fr))",
          }}
        >
          {!error &&
            (filteredArticles.length === 0 ? (
              <p style={{ color: "gray" }}>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É.</p>
            ) : (
              filteredArticles.map((article, index) => (
                <div
                  key={index}
                  style={{
                    border: "1px solid #ccc",
                    borderRadius: "10px",
                    padding: "1rem",
                    backgroundColor: "#1e1e1e",
                    color: "#fff",
                  }}
                >
                  <h2>{article.title}</h2>
                  {article.urlToImage && (
                    <img
                      src={article.urlToImage}
                      alt="image"
                      style={{ maxWidth: "100%", borderRadius: "8px" }}
                    />
                  )}
                  <p>{article.description}</p>
                  <a
                    href={article.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    style={{ color: "lightblue" }}
                  >
                    –ß–∏—Ç–∞—Ç—å
                  </a>
                </div>
              ))
            ))}
        </div>
      )}
    </div>
  );
}

export default App;
